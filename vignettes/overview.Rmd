---
title: "Overview"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---
```{r, echo = FALSE}
library(tableMatrix)
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path='figures/README-'
)
```

#tableMatrix

`tableMatrix` package provides structures to store data. First one is tableList which only serves to wrap data.table and additional structures together, second is tableMatrix that combines useful features of data.table and matrix to gain faster access to data.

##Installation
From github:
```{r eval=FALSE}
# install.packages("devtools")
devtools::install_github("InferenceTechnologies/tableMatrix")
```

##Motivation

###tableList
It is needed to wrap a data.table object and other structures together and preserve data.table behaviour.

####Example
Dataset and linear model stored in tableList.

```{r}
data(chickwts)
tl <- tableList(chickwts, lm(weight~feed, chickwts))

mean(tl[feed=="casein", weight])

aid(tl)
```

###tableMatrix
Let's have dataset which consists of two parts - metadata columns (any types) and main data columns (only one type). If whole data were stored as data.table (data.frame), access to main part would be much slower (slow indexing in data.table). 
`tableMatrix` is result for this. It combines best of data.table (access via bracket to metadata part) and matrix. It stores dimensions of main part and effectively use this information while using multiple datasets which can have different dimensions of main data. It also can store additional structures.

####Example
Solving simple task - recreating pictures from data with `tableMatrix`. Used datasets (images8By8, images15By15) are bitmaps. 
First let's see a sample image of a images8By8 dataset.

```{r}
#loading data
data(images8By8)
?images8By8
data(images15By15)

#creating tableMatrix from both datasets
#first 3 cols used as metadata, rest as main data, dimensions of images
tm <- tableMatrix(list(images15By15, images8By8),
list(1:3, 1:3), list(c(4:ncol(images15By15)),c(4:ncol(images8By8))), list(c(15,15), c(8,8)))

#number of matrices stored in mat part
length(mat(tm))

#dimensions of main data
#2 matrices in mat part -> 2 rows in matDim
matDim(tm)


#additional structures - now empty
aid(tm)

#metadata
#tm.matN and tm.matRow are data.table keys 
#tm.matN is index of a matrix in mat part
tab(tm)

#image data from first row of 2nd matrix in mat part
image <- getRow(tm,repo=c(2,1))

#restoring dimension of this image
dim(image) <- getRowDim(tm,repo=c(2,1))

#visualising image
image(image)
```

Now we'll recreate heat map.
```{r}
#subsetting via bracket passed to metadata part
#selecting via tm.matN and direction
tabSub <- tm[.(2)][direction=="down"]

#only 1 matrix is in mat
matDim(tabSub)

#confirmation
length(mat(tabSub))

#recreating heat map from means of samples
imageMean <- colMeans(mat(tabSub,1))

#restoring original dimensions
dim(imageMean) <- getRowDim(tabSub,1)

#visualising image
image(imageMean)
```